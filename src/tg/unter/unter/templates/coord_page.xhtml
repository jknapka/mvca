<html py:extends="master.xhtml" py:strip="True">
  <head py:block="head" py:strip="True">
    <title py:block="master_title">List of volunteer needs</title>
    <meta name="generator" content="HTML Tidy for Linux/x86 (vers 11 February 2007), see www.w3.org" />
  </head>

  <body py:block="body" py:strip="True">
    <?python
import time
perms = [p.permission_name for p in user.permissions]
isCoordinator = 'manage_events' in perms
    ?>
    <div class="row">
      <div class="col-md-12">
        <div class="page-header">
		<h2>Welcome to your Coordinator page, ${user.display_name}.</h2>
		<span id="message-span" py:if="message">${message}</span>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">

			<div class="unter-actions">
				<span>
					<a style="border-right: 1px solid black"
						href="/add_need_event_start">New event </a>
				</span>
				<span>
					<a  style="border-right: 1px solid black"
						href="/need_events?completed=0">&nbsp;See all active events </a>
				</span>
				<span>
					<a  style="border-right: 1px solid black"
						href="/add_volunteer_start">&nbsp;Add volunteer </a>
				</span>
				<span>
					<a  style="border-right: 1px solid black"
						href="/all_volunteers">&nbsp;See all volunteers </a>
				</span>
				<span>
					<a href="/need_events?completed=1">&nbsp;See completed events</a>
				</span>
			</div>
	      
		  <div><h3>Events you have created.</h3></div>
	      <div class="unter-coord-events">
		<table border="1">
			<thead>
				<tr>
					<th>Event ID</th>
					<th>Date</th>
					<th>Time</th>
					<th>Service</th>
					<th>Location</th>
					<th>Notes</th>
					<th>Volunteers</th>
					<th>Last alert sent</th>
				</tr>
			</thead>
			<tbody>
				<tr py:for="ev in events">
					<td><a href="${tg.url('/event_details',dict(neid=ev.ev.neid))}">${ev.ev.neid}</a></td>
					<td><a href="${tg.url('/event_details',dict(neid=ev.ev.neid))}">${ev.date_str}</a></td>
					<td><a href="${tg.url('/event_details',dict(neid=ev.ev.neid))}">${ev.time_str}</a></td>
					<td><a href="${tg.url('/event_details',dict(neid=ev.ev.neid))}">${ev.ev_str}</a></td>
					<td><a href="${tg.url('/event_details',dict(neid=ev.ev.neid))}">${ev.ev.location}</a></td>
					<td><a href="${tg.url('/event_details',dict(neid=ev.ev.neid))}">${ev.ev.notes}</a></td>
					<td>
						<ul py:if="ev.ev.responses">
							<li py:for="vr in ev.ev.responses">
								<a href="${tg.url('/volunteer_info',dict(user_id=vr.user.user_id))}">
									${vr.user.display_name}
								</a>
							</li>
						</ul>
						<a href="${tg.url('/event_details',dict(neid=ev.ev.neid))}">See volunteers</a>
					</td>
					<td id="alert-time-neid-${ev.ev.neid}">${ev.last_alert_time}
						<a py:if="isCoordinator and ev.ev.complete != 1 and time.time() - 3600 > ev.ev.last_alert_time"
							   href="/send_alert?neid=${ev.ev.neid}"><br/>Send alert</a>
					</td>
				</tr>
			</tbody>
		</table>
	      </div>
      </div>
    </div>
  </body>
</html>

